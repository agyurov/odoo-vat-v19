{
    "name": "deklar_mapping",
    "description": "Logical mapping for Deklar.csv fields, showing where each value comes from.",
    "fields": [
        {
            "id": 1,
            "deklar_column": "vat_number",
            "source_kind": "from_input_or_company",
            "source_detail": "VAT number of the taxpayer; taken from company/journal or configuration."
        },
        {
            "id": 2,
            "deklar_column": "taxpayer_name",
            "source_kind": "from_input_or_company",
            "source_detail": "Legal or display name of the taxpayer; taken from company/journal or configuration."
        },
        {
            "id": 3,
            "deklar_column": "tax_period",
            "source_kind": "from_input_or_company",
            "source_detail": "Accounting period in YYYYMM; derived from max journal date or user input."
        },
        {
            "id": 4,
            "deklar_column": "submitter_person",
            "source_kind": "from_input_or_company",
            "source_detail": "Name of the person submitting the declaration; provided as parameter/config."
        },
        {
            "id": 5,
            "deklar_column": "sales_document_count",
            "source_kind": "from_input_or_company",
            "source_detail": "Number of sales documents; typically len(prodagbi)."
        },
        {
            "id": 6,
            "deklar_column": "purchases_document_count",
            "source_kind": "from_input_or_company",
            "source_detail": "Number of purchase documents; typically len(pokupki)."
        },
        {
            "id": 7,
            "deklar_column": "sales_total_tax_base",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "total_tax_base",
            "aggregation": "sum"
        },
        {
            "id": 8,
            "deklar_column": "sales_total_vat",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "total_vat",
            "aggregation": "sum"
        },
        {
            "id": 9,
            "deklar_column": "sales_base_20",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "base_20",
            "aggregation": "sum"
        },
        {
            "id": 10,
            "deklar_column": "sales_vat_20",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "vat_20",
            "aggregation": "sum"
        },
        {
            "id": 11,
            "deklar_column": "sales_base_intra_community_and_82",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "base_intra_community_acq",
            "aggregation": "sum"
        },
        {
            "id": 12,
            "deklar_column": "sales_vat_intra_community_and_82",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "base_reverse_charge_82",
            "aggregation": "sum"
        },
        {
            "id": 13,
            "deklar_column": "sales_vat_private_use",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "vat_intra_community_and_82",
            "aggregation": "sum"
        },
        {
            "id": 14,
            "deklar_column": "sales_base_9",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "vat_for_private_use",
            "aggregation": "sum"
        },
        {
            "id": 15,
            "deklar_column": "sales_vat_9",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "base_9",
            "aggregation": "sum"
        },
        {
            "id": 16,
            "deklar_column": "sales_base_0_chapter3",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "base_0_chapter3",
            "aggregation": "sum"
        },
        {
            "id": 17,
            "deklar_column": "sales_base_0_intra_community_supply",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "base_0_intra_community_supply",
            "aggregation": "sum"
        },
        {
            "id": 18,
            "deklar_column": "sales_base_0_other",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "base_0_other",
            "aggregation": "sum"
        },
        {
            "id": 19,
            "deklar_column": "sales_base_services_21_2",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "base_services_21_2",
            "aggregation": "sum"
        },
        {
            "id": 20,
            "deklar_column": "sales_base_69_2_eu",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "base_69_2_eu",
            "aggregation": "sum"
        },
        {
            "id": 21,
            "deklar_column": "sales_base_exempt",
            "source_kind": "sum_prodagbi_column",
            "source_table": "prodagbi",
            "source_column": "base_exempt",
            "aggregation": "sum"
        },
        {
            "id": 22,
            "deklar_column": "purchases_base_and_vat_no_credit",
            "source_kind": "sum_pokupki_column",
            "source_table": "pokupki",
            "source_column": "base_and_vat_no_credit",
            "aggregation": "sum"
        },
        {
            "id": 23,
            "deklar_column": "purchases_base_full_credit",
            "source_kind": "sum_pokupki_column",
            "source_table": "pokupki",
            "source_column": "base_full_credit",
            "aggregation": "sum"
        },
        {
            "id": 24,
            "deklar_column": "purchases_vat_full_credit",
            "source_kind": "sum_pokupki_column",
            "source_table": "pokupki",
            "source_column": "vat_full_credit",
            "aggregation": "sum"
        },
        {
            "id": 25,
            "deklar_column": "purchases_base_partial_credit",
            "source_kind": "sum_pokupki_column",
            "source_table": "pokupki",
            "source_column": "base_partial_credit",
            "aggregation": "sum"
        },
        {
            "id": 26,
            "deklar_column": "purchases_vat_partial_credit",
            "source_kind": "sum_pokupki_column",
            "source_table": "pokupki",
            "source_column": "vat_partial_credit",
            "aggregation": "sum"
        },
        {
            "id": 27,
            "deklar_column": "purchases_annual_correction",
            "source_kind": "sum_pokupki_column",
            "source_table": "pokupki",
            "source_column": "annual_correction",
            "aggregation": "sum"
        },
        {
            "id": 28,
            "deklar_column": "pro_rata_coefficient",
            "source_kind": "manual_or_constant",
            "default_value": 0,
            "note": "Pro-rata coefficient; may be user input or configuration. Default 0 in current mapping."
        },
        {
            "id": 29,
            "deklar_column": "total_tax_credit",
            "source_kind": "from_deklar_expression",
            "expression": "cell.41+cell.42*cell.33+cell.43)",
            "note": "Logical formula from NRA PDF; should be implemented using deklar field names rather than cell numbers."
        },
        {
            "id": 30,
            "deklar_column": "vat_due",
            "source_kind": "from_deklar_expression",
            "expression": "(cell.20-cell.40)>0",
            "note": "Conceptually: max(0, sales_total_vat - total_tax_credit)."
        },
        {
            "id": 31,
            "deklar_column": "vat_refundable",
            "source_kind": "from_deklar_expression",
            "expression": "cell.20-cell.40)<0",
            "note": "Conceptually: max(0, total_tax_credit - sales_total_vat)."
        },
        {
            "id": 32,
            "deklar_column": "vat_offset_92_1",
            "source_kind": "manual_or_constant",
            "default_value": 0,
            "note": "Offset under Art.92(1); defaulted to 0."
        },
        {
            "id": 33,
            "deklar_column": "vat_paid",
            "source_kind": "manual_or_constant",
            "default_value": 0,
            "note": "Paid VAT for the period; defaulted to 0 until payment data is integrated."
        },
        {
            "id": 34,
            "deklar_column": "vat_refundable_92_1",
            "source_kind": "manual_or_constant",
            "default_value": 0,
            "note": "Refundable VAT under Art.92(1); defaulted to 0."
        },
        {
            "id": 35,
            "deklar_column": "vat_refundable_92_3",
            "source_kind": "manual_or_constant",
            "default_value": 0,
            "note": "Refundable VAT under Art.92(3); defaulted to 0."
        },
        {
            "id": 36,
            "deklar_column": "vat_refundable_92_4",
            "source_kind": "manual_or_constant",
            "default_value": 0,
            "note": "Refundable VAT under Art.92(4); defaulted to 0."
        }
    ]
}